<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotto-Tech Thai</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #050816; /* Deep space blue */
        }
        .tech-glow {
            transition: all 0.3s ease;
            box-shadow: 0 0 5px rgba(34, 211, 238, 0.4), 0 0 10px rgba(34, 211, 238, 0.3);
        }
        .tech-glow:hover {
            box-shadow: 0 0 15px rgba(34, 211, 238, 0.8), 0 0 25px rgba(34, 211, 238, 0.6);
        }
        @keyframes number-flicker {
            0%, 100% { opacity: 1; transform: translateY(0); filter: blur(0); }
            50% { opacity: 0.5; transform: translateY(-10px); filter: blur(2px); }
        }
        .flicker { animation: number-flicker 0.2s infinite; }
        .number-display {
            font-size: clamp(2.5rem, 10vw, 4rem);
            font-weight: 700;
            letter-spacing: 0.1em;
            text-shadow: 0 0 10px rgba(34, 211, 238, 0.5);
            color: #22d3ee; /* Cyan-400 */
        }
        .card {
            background-color: rgba(15, 23, 42, 0.5); /* Slate-900 with 50% opacity */
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(56, 189, 248, 0.2); /* Sky-400 */
            border-radius: 1rem;
            position: relative;
            overflow: hidden;
        }
        .ai-reasoning {
            background: rgba(0,0,0,0.3);
            border-left: 3px solid #22d3ee; /* Cyan-400 */
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1.5rem;
            font-size: 0.95rem;
            line-height: 1.6;
            color: #d1d5db;
            white-space: pre-wrap;
        }
    </style>
</head>
<body class="text-gray-200">

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-8">
            <!-- การเปลี่ยนแปลง: โลโก้หุ่นยนต์ AI ใหม่ -->
            <div class="w-24 h-24 sm:w-28 sm:h-28 mx-auto mb-4 flex items-center justify-center">
                <svg viewBox="0 0 100 100" class="w-full h-full">
                    <path d="M25,35 A15,15 0 0,1 75,35 L75,65 A15,15 0 0,1 25,65 Z" stroke="#22d3ee" stroke-width="3" fill="none"/>
                    <circle cx="40" cy="48" r="4" fill="#22d3ee"/>
                    <circle cx="60" cy="48" r="4" fill="#22d3ee"/>
                    <line x1="35" y1="60" x2="65" y2="60" stroke="#22d3ee" stroke-width="2"/>
                    <line x1="50" y1="35" x2="50" y2="25" stroke="#22d3ee" stroke-width="2"/>
                    <circle cx="50" cy="22" r="3" fill="#22d3ee"/>
                </svg>
            </div>
            
            <h1 class="text-4xl md:text-5xl font-bold text-cyan-400" style="text-shadow: 0 0 15px rgba(34, 211, 238, 0.5);">Lotto-Tech Thai</h1>
            <p class="text-lg text-gray-400 mt-2">วิเคราะห์ด้วยเทคโนโลยี AI และ Big Data</p>
            <div id="datetime" class="mt-4 text-xl text-sky-300"></div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-5 gap-8">

            <div class="lg:col-span-3 card p-6 md:p-8">
                <div class="flex justify-between items-center flex-wrap gap-2">
                    <h2 class="text-2xl font-semibold text-white">ผลการวิเคราะห์จาก AI</h2>
                    <p class="text-sky-400 text-sm sm:text-base" id="draw-date"></p>
                </div>
                <div id="ai-status" class="mt-2 h-6 text-lg text-sky-300 transition-opacity duration-500"></div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 sm:gap-8 my-8">
                    <div class="text-center bg-black/40 backdrop-blur-sm p-6 rounded-lg">
                        <h3 class="text-xl font-medium text-gray-300 mb-4">เลขท้าย 2 ตัว</h3>
                        <div id="result-2-digit" class="number-display">--</div>
                    </div>
                    <div class="text-center bg-black/40 backdrop-blur-sm p-6 rounded-lg">
                        <h3 class="text-xl font-medium text-gray-300 mb-4">เลขท้าย 3 ตัว</h3>
                        <div id="result-3-digit" class="number-display">---</div>
                    </div>
                </div>

                <div id="ai-reasoning-box" class="ai-reasoning hidden">
                    <p class="font-semibold text-cyan-400 mb-2">หลักการวิเคราะห์ของ Lotto-Tech AI:</p>
                    <p id="ai-reasoning-text"></p>
                </div>
            </div>

            <div class="lg:col-span-2 space-y-8">
                <div class="card p-6 md:p-8">
                    <h2 class="text-2xl font-semibold text-white mb-4">AI วิเคราะห์ความฝัน</h2>
                    <textarea id="dream-input" class="w-full bg-slate-800/70 border border-slate-600 rounded-lg p-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-cyan-400" rows="4" placeholder="เล่าความฝันของคุณให้ AI ฟัง..."></textarea>
                    <button id="dream-analyze-button" class="mt-4 w-full bg-cyan-500 text-slate-900 font-bold text-lg py-3 rounded-full tech-glow transform hover:scale-105">
                        <span id="dream-button-text">ทำนายฝัน</span>
                    </button>
                    <div id="dream-result-box" class="ai-reasoning hidden">
                         <p id="dream-result-text"></p>
                    </div>
                </div>

                <div class="card p-6 md:p-8">
                    <h2 class="text-2xl font-semibold text-white mb-4">ผลรางวัลและสถิติ</h2>
                    <div class="mb-6">
                        <h3 class="text-lg font-medium text-sky-400 border-b border-sky-400/20 pb-2 mb-3">ผลสลากฯ งวดล่าสุด (16 ก.ค. 68)</h3>
                        <div class="space-y-2 text-gray-300">
                            <p>รางวัลที่ 1: <span class="font-bold text-white">955551</span></p>
                            <p>เลขท้าย 2 ตัว: <span id="actual-2-digit" class="font-bold text-white">40</span></p>
                            <p>เลขท้าย 3 ตัว: <span id="actual-3-digit-1" class="font-bold text-white">412</span>, <span id="actual-3-digit-2" class="font-bold text-white">703</span></p>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-medium text-sky-400 border-b border-sky-400/20 pb-2 mb-3">สถิติความแม่นยำของ AI (เริ่ม ส.ค. 68)</h3>
                        <div class="space-y-2">
                            <p>ทายถูก: <span id="ai-hits" class="font-bold text-green-400">0</span> ครั้ง</p>
                            <p>ทายผิด: <span id="ai-misses" class="font-bold text-red-400">0</span> ครั้ง</p>
                            <p>อัตราความแม่นยำ: <span id="ai-accuracy-rate" class="font-bold text-sky-300">N/A</span></p>
                        </div>
                    </div>
                    <div id="verdict-message" class="mt-4 p-4 rounded-lg text-center font-semibold transition-all duration-500 opacity-0"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const datetimeEl = document.getElementById('datetime');
            const result2DigitEl = document.getElementById('result-2-digit');
            const result3DigitEl = document.getElementById('result-3-digit');
            const aiStatusEl = document.getElementById('ai-status');
            const aiReasoningBox = document.getElementById('ai-reasoning-box');
            const aiReasoningText = document.getElementById('ai-reasoning-text');
            const verdictMessageEl = document.getElementById('verdict-message');
            const aiHitsEl = document.getElementById('ai-hits');
            const aiMissesEl = document.getElementById('ai-misses');
            const aiAccuracyRateEl = document.getElementById('ai-accuracy-rate');
            const dreamInput = document.getElementById('dream-input');
            const dreamAnalyzeButton = document.getElementById('dream-analyze-button');
            const dreamButtonText = document.getElementById('dream-button-text');
            const dreamResultBox = document.getElementById('dream-result-box');
            const dreamResultText = document.getElementById('dream-result-text');
            const drawDateEl = document.getElementById('draw-date');

            let aiStats = JSON.parse(localStorage.getItem('lottoTechStats_v2')) || { hits: 0, misses: 0 };
            let predictedNumbers = JSON.parse(localStorage.getItem('lottoTechPredicted_v2')) || { twoDigit: null, threeDigit: null, reason: null, drawDate: null };

            function updateTime() {
                const now = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', timeZone: 'Asia/Bangkok' };
                datetimeEl.textContent = `${now.toLocaleDateString('th-TH', options)} เวลา ${now.toLocaleTimeString('th-TH', { timeZone: 'Asia/Bangkok' })}`;
            }
            setInterval(updateTime, 1000);
            updateTime();

            const reasoningTemplates = [
                "ระบบ AI ได้ประมวลผล Big Data จากสถิติย้อนหลัง 20 ปี และพบว่ากลุ่มเลข {0} มีค่า Correlation สูงสุดกับปัจจัยทางเศรษฐกิจในปัจจุบัน จึงคาดการณ์ว่าเลข {2} และ {3} มีโอกาสออกรางวัลสูง",
                "จากการใช้โมเดล Machine Learning ประเภท 'Random Forest' วิเคราะห์แพทเทิร์นการออกรางวัล พบว่าเลข {1} มีค่า 'Feature Importance' สูงสุดในรอบ 3 เดือนที่ผ่านมา เมื่อรวมกับเลขเด่น {0} จึงได้ผลลัพธ์เป็น {2} และ {3}",
                "AI ได้วิเคราะห์ข้อมูลจากโซเชียลมีเดียกว่า 10 ล้านข้อความ และพบว่าเลข {0} และ {1} ถูกกล่าวถึงบ่อยครั้งในบริบทของโชคลาภ ระบบจึงให้น้ำหนักกับเลขชุดนี้ ทำให้ได้ผลการทำนายเป็น {2} และ {3}",
            ];

            function generateReasoning(num2, num3) {
                const n1 = num3.charAt(Math.floor(Math.random() * 3));
                const n2 = num2.charAt(Math.floor(Math.random() * 2));
                const template = reasoningTemplates[Math.floor(Math.random() * reasoningTemplates.length)];
                return template.replace('{0}', n1).replace('{1}', n2).replace('{2}', num2).replace('{3}', num3);
            }
            
            function getUpcomingDrawInfo() {
                const now = new Date();
                const year = now.getFullYear();
                const month = now.getMonth();
                const day = now.getDate();
                const draw1 = new Date(year, month, 1);
                const draw16 = new Date(year, month, 16);
                let upcomingDrawDate;
                if (now < draw1) { upcomingDrawDate = draw1; } 
                else if (now < draw16) { upcomingDrawDate = draw16; } 
                else { upcomingDrawDate = new Date(year, month + 1, 1); }
                const analysisStartDate = new Date(upcomingDrawDate);
                analysisStartDate.setDate(analysisStartDate.getDate() - 1);
                analysisStartDate.setHours(0, 0, 0, 0);
                return { upcomingDrawDate, analysisStartDate };
            }

            function startAutomaticAnalysis(upcomingDrawDate) {
                aiStatusEl.textContent = 'Lotto-Tech AI กำลังประมวลผล Big Data...';
                result2DigitEl.classList.add('flicker');
                result3DigitEl.classList.add('flicker');
                result2DigitEl.textContent = "88";
                result3DigitEl.textContent = "888";
                setTimeout(() => {
                    const num2digit = String(Math.floor(Math.random() * 100)).padStart(2, '0');
                    const num3digit = String(Math.floor(Math.random() * 1000)).padStart(3, '0');
                    const reason = generateReasoning(num2digit, num3digit);
                    predictedNumbers = {
                        twoDigit: num2digit, threeDigit: num3digit, reason: reason,
                        drawDate: upcomingDrawDate.toISOString().split('T')[0]
                    };
                    localStorage.setItem('lottoTechPredicted_v2', JSON.stringify(predictedNumbers));
                    displayPrediction();
                    aiStatusEl.textContent = 'การวิเคราะห์ข้อมูลเสร็จสมบูรณ์';
                }, 2500);
            }
            
            function displayPrediction() {
                 if(predictedNumbers.twoDigit) {
                    result2DigitEl.classList.remove('flicker');
                    result3DigitEl.classList.remove('flicker');
                    result2DigitEl.textContent = predictedNumbers.twoDigit;
                    result3DigitEl.textContent = predictedNumbers.threeDigit;
                    aiReasoningText.textContent = predictedNumbers.reason;
                    aiReasoningBox.classList.remove('hidden');
                 }
            }

            function initializeLotteryCycle() {
                const now = new Date();
                const { upcomingDrawDate, analysisStartDate } = getUpcomingDrawInfo();
                const drawDateString = upcomingDrawDate.toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' });
                drawDateEl.textContent = `งวดวันที่ ${drawDateString}`;
                const storedDrawDate = predictedNumbers.drawDate;
                const upcomingDrawDateStr = upcomingDrawDate.toISOString().split('T')[0];
                if (now >= analysisStartDate) {
                    if (storedDrawDate !== upcomingDrawDateStr) { startAutomaticAnalysis(upcomingDrawDate); } 
                    else { aiStatusEl.textContent = 'ผลการวิเคราะห์สำหรับงวดปัจจุบัน'; displayPrediction(); }
                } else {
                    const analysisDateString = analysisStartDate.toLocaleDateString('th-TH', { day: 'numeric', month: 'long' });
                    aiStatusEl.textContent = `AI จะเริ่มวิเคราะห์ในวันที่ ${analysisDateString}`;
                    result2DigitEl.textContent = 'รอผล';
                    result3DigitEl.textContent = 'รอผล';
                    aiReasoningBox.classList.add('hidden');
                }
            }
            
            function updateStatsUI() {
                aiHitsEl.textContent = aiStats.hits;
                aiMissesEl.textContent = aiStats.misses;
                const total = aiStats.hits + aiStats.misses;
                const accuracy = total > 0 ? ((aiStats.hits / total) * 100).toFixed(1) : 0;
                aiAccuracyRateEl.textContent = total > 0 ? `${accuracy}%` : 'N/A';
            }

            async function analyzeDreamWithGemini() {
                const dreamText = dreamInput.value;
                if (!dreamText.trim()) {
                    dreamResultText.innerHTML = `<span class="text-red-400">กรุณาเล่าความฝันของคุณก่อน</span>`;
                    dreamResultBox.classList.remove('hidden');
                    return;
                }

                dreamButtonText.textContent = 'กำลังวิเคราะห์...';
                dreamAnalyzeButton.disabled = true;
                dreamResultBox.classList.remove('hidden');
                dreamResultText.innerHTML = 'Lotto-Tech AI กำลังประมวลผลความฝัน...';

                const apiKey = "AIzaSyDy8R_EQJRYEmWXbTgmS-IwvN34_vZmsDE"; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                
                const prompt = `ในฐานะ "Lotto-Tech AI" ที่เชี่ยวชาญการทำนายฝันโดยอ้างอิงจากตำราโบราณและหลักจิตวิทยา จงวิเคราะห์ความฝันต่อไปนี้:\n\n"${dreamText}"\n\nจงให้คำทำนายที่เชื่อมโยงกับชีวิตจริงของผู้ฝันในด้านต่างๆ เช่น การงาน การเงิน ความรัก สุขภาพ และคำเตือน จากนั้นให้ตีความเป็น "เลขนำโชค" สองตัวและสามตัว พร้อมอธิบายเหตุผลที่มาของตัวเลขอย่างสั้นๆ จัดรูปแบบคำตอบให้สวยงาม อ่านง่าย มีหัวข้อชัดเจน`;
                
                const payload = {
                    contents: [{
                        parts: [{ text: prompt }]
                    }]
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API Error: ${response.statusText}`);
                    }

                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0) {
                        const interpretation = result.candidates[0].content.parts[0].text;
                        dreamResultText.innerHTML = interpretation;
                    } else {
                        dreamResultText.innerHTML = 'ขออภัย AI ไม่สามารถวิเคราะห์ความฝันได้ในขณะนี้ กรุณาลองใหม่อีกครั้ง';
                    }

                } catch (error) {
                    console.error("Error analyzing dream:", error);
                    dreamResultText.innerHTML = 'เกิดข้อผิดพลาดในการเชื่อมต่อกับ AI กรุณาตรวจสอบการเชื่อมต่อและลองใหม่อีกครั้ง';
                } finally {
                    dreamButtonText.textContent = 'ทำนายฝัน';
                    dreamAnalyzeButton.disabled = false;
                }
            }
            
            dreamAnalyzeButton.addEventListener('click', analyzeDreamWithGemini);

            updateStatsUI();
            initializeLotteryCycle();
        });
    </script>
</body>
</html>
